# --- GRIP
new FeatureGeneric featureGrip
new FeatureGeneric featureGripDes
set featureGrip.jacobianIN [2,38]((0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0),(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1))
new Stack<vector> griperPos
plug dyn.position griperPos.in1
plug dyn.position griperPos.in2
griperPos.selec1 29 30
griperPos.selec2 37 38
plug griperPos.out featureGrip.errorIN
set featureGripDes.errorIN [2](0.2,0.2)
set featureGrip.sdes featureGripDes

new Task taskGrip
taskGrip.add featureGrip
set taskGrip.controlGain 1

# --- TORQUE EXCESS CONTROL --------------------------
new GripperControl gripdes

new  Selec<vector> sljl
sljl.selec 6 38
plug dyn.lowerJl sljl.in
new  Selec<vector> sujl
sujl.selec 6 38
plug dyn.upperJl sujl.in

plug sujl.out gripdes.upperLimitFullIN
plug sljl.out gripdes.lowerLimitFullIN
set gripdes.torqueLimit [2](3,3)
setflag gripdes.selec #22
setflag gripdes.selec |29

plug gripdes.reference featureGripDes.errorIN

gripdes.offset 0.99

# --- TORQUE FILTERING -------------------------------
new ConvolutionTemporal griptorq
plug gripdes.torqueReducedOUT griptorq.in1
plug griptorq.out gripdes.torque

# Gaussian filter, 200 iteration delay
# set griptorq.in2 [2,169]((0.0001,0.0001,0.0001,0.0001,0.0001,0.0001,0.0001,0.0001,0.0002,0.0002,0.0002,0.0002,0.0003,0.0003,0.0003,0.0004,0.0004,0.0004,0.0005,0.0005,0.0006,0.0007,0.0007,0.0008,0.0009,0.0010,0.0011,0.0012,0.0013,0.0014,0.0015,0.0017,0.0018,0.0020,0.0022,0.0023,0.0025,0.0027,0.0029,0.0032,0.0034,0.0036,0.0039,0.0042,0.0044,0.0047,0.0050,0.0053,0.0057,0.0060,0.0063,0.0067,0.0070,0.0074,0.0078,0.0081,0.0085,0.0089,0.0093,0.0097,0.0101,0.0105,0.0108,0.0112,0.0116,0.0120,0.0123,0.0127,0.0130,0.0133,0.0136,0.0139,0.0142,0.0145,0.0147,0.0150,0.0152,0.0153,0.0155,0.0156,0.0158,0.0158,0.0159,0.0159,0.0160,0.0159,0.0159,0.0158,0.0158,0.0156,0.0155,0.0153,0.0152,0.0150,0.0147,0.0145,0.0142,0.0139,0.0136,0.0133,0.0130,0.0127,0.0123,0.0120,0.0116,0.0112,0.0108,0.0105,0.0101,0.0097,0.0093,0.0089,0.0085,0.0081,0.0078,0.0074,0.0070,0.0067,0.0063,0.0060,0.0057,0.0053,0.0050,0.0047,0.0044,0.0042,0.0039,0.0036,0.0034,0.0032,0.0029,0.0027,0.0025,0.0023,0.0022,0.0020,0.0018,0.0017,0.0015,0.0014,0.0013,0.0012,0.0011,0.0010,0.0009,0.0008,0.0007,0.0007,0.0006,0.0005,0.0005,0.0004,0.0004,0.0004,0.0003,0.0003,0.0003,0.0002,0.0002,0.0002,0.0002,0.0001,0.0001,0.0001,0.0001,0.0001,0.0001,0.0001,0.0001),(0.0001,0.0001,0.0001,0.0001,0.0001,0.0001,0.0001,0.0001,0.0002,0.0002,0.0002,0.0002,0.0003,0.0003,0.0003,0.0004,0.0004,0.0004,0.0005,0.0005,0.0006,0.0007,0.0007,0.0008,0.0009,0.0010,0.0011,0.0012,0.0013,0.0014,0.0015,0.0017,0.0018,0.0020,0.0022,0.0023,0.0025,0.0027,0.0029,0.0032,0.0034,0.0036,0.0039,0.0042,0.0044,0.0047,0.0050,0.0053,0.0057,0.0060,0.0063,0.0067,0.0070,0.0074,0.0078,0.0081,0.0085,0.0089,0.0093,0.0097,0.0101,0.0105,0.0108,0.0112,0.0116,0.0120,0.0123,0.0127,0.0130,0.0133,0.0136,0.0139,0.0142,0.0145,0.0147,0.0150,0.0152,0.0153,0.0155,0.0156,0.0158,0.0158,0.0159,0.0159,0.0160,0.0159,0.0159,0.0158,0.0158,0.0156,0.0155,0.0153,0.0152,0.0150,0.0147,0.0145,0.0142,0.0139,0.0136,0.0133,0.0130,0.0127,0.0123,0.0120,0.0116,0.0112,0.0108,0.0105,0.0101,0.0097,0.0093,0.0089,0.0085,0.0081,0.0078,0.0074,0.0070,0.0067,0.0063,0.0060,0.0057,0.0053,0.0050,0.0047,0.0044,0.0042,0.0039,0.0036,0.0034,0.0032,0.0029,0.0027,0.0025,0.0023,0.0022,0.0020,0.0018,0.0017,0.0015,0.0014,0.0013,0.0012,0.0011,0.0010,0.0009,0.0008,0.0007,0.0007,0.0006,0.0005,0.0005,0.0004,0.0004,0.0004,0.0003,0.0003,0.0003,0.0002,0.0002,0.0002,0.0002,0.0001,0.0001,0.0001,0.0001,0.0001,0.0001,0.0001,0.0001))

# 100 iter delay
# set griptorq.in2 [2,85]((2.001601e-04,2.001601e-04,2.001601e-04,2.001601e-04,4.003203e-04,4.003203e-04,6.004804e-04,6.004804e-04,8.006405e-04,1.000801e-03,1.200961e-03,1.401121e-03,1.801441e-03,2.201761e-03,2.602082e-03,3.002402e-03,3.602882e-03,4.403523e-03,5.004003e-03,5.804644e-03,6.805444e-03,7.806245e-03,8.807046e-03,1.000801e-02,1.140913e-02,1.261009e-02,1.401121e-02,1.561249e-02,1.701361e-02,1.861489e-02,2.021617e-02,2.161729e-02,2.321857e-02,2.461970e-02,2.602082e-02,2.722178e-02,2.842274e-02,2.942354e-02,3.042434e-02,3.102482e-02,3.162530e-02,3.182546e-02,3.202562e-02,3.182546e-02,3.162530e-02,3.102482e-02,3.042434e-02,2.942354e-02,2.842274e-02,2.722178e-02,2.602082e-02,2.461970e-02,2.321857e-02,2.161729e-02,2.021617e-02,1.861489e-02,1.701361e-02,1.561249e-02,1.401121e-02,1.261009e-02,1.140913e-02,1.000801e-02,8.807046e-03,7.806245e-03,6.805444e-03,5.804644e-03,5.004003e-03,4.403523e-03,3.602882e-03,3.002402e-03,2.602082e-03,2.201761e-03,1.801441e-03,1.401121e-03,1.200961e-03,1.000801e-03,8.006405e-04,6.004804e-04,6.004804e-04,4.003203e-04,4.003203e-04,2.001601e-04,2.001601e-04,2.001601e-04,2.001601e-04),(2.001601e-04,2.001601e-04,2.001601e-04,2.001601e-04,4.003203e-04,4.003203e-04,6.004804e-04,6.004804e-04,8.006405e-04,1.000801e-03,1.200961e-03,1.401121e-03,1.801441e-03,2.201761e-03,2.602082e-03,3.002402e-03,3.602882e-03,4.403523e-03,5.004003e-03,5.804644e-03,6.805444e-03,7.806245e-03,8.807046e-03,1.000801e-02,1.140913e-02,1.261009e-02,1.401121e-02,1.561249e-02,1.701361e-02,1.861489e-02,2.021617e-02,2.161729e-02,2.321857e-02,2.461970e-02,2.602082e-02,2.722178e-02,2.842274e-02,2.942354e-02,3.042434e-02,3.102482e-02,3.162530e-02,3.182546e-02,3.202562e-02,3.182546e-02,3.162530e-02,3.102482e-02,3.042434e-02,2.942354e-02,2.842274e-02,2.722178e-02,2.602082e-02,2.461970e-02,2.321857e-02,2.161729e-02,2.021617e-02,1.861489e-02,1.701361e-02,1.561249e-02,1.401121e-02,1.261009e-02,1.140913e-02,1.000801e-02,8.807046e-03,7.806245e-03,6.805444e-03,5.804644e-03,5.004003e-03,4.403523e-03,3.602882e-03,3.002402e-03,2.602082e-03,2.201761e-03,1.801441e-03,1.401121e-03,1.200961e-03,1.000801e-03,8.006405e-04,6.004804e-04,6.004804e-04,4.003203e-04,4.003203e-04,2.001601e-04,2.001601e-04,2.001601e-04,2.001601e-04))

# 60 iter delay
# set griptorq.in2 [2,57]((2.997602e-04,2.997602e-04,2.997602e-04,5.995204e-04,8.992806e-04,1.199041e-03,1.498801e-03,2.098321e-03,2.697842e-03,3.597122e-03,4.496403e-03,5.995204e-03,7.494005e-03,9.592326e-03,1.169065e-02,1.408873e-02,1.708633e-02,2.008393e-02,2.338129e-02,2.667866e-02,3.027578e-02,3.357314e-02,3.687050e-02,3.986811e-02,4.256595e-02,4.496403e-02,4.646283e-02,4.736211e-02,4.796163e-02,4.736211e-02,4.646283e-02,4.496403e-02,4.256595e-02,3.986811e-02,3.687050e-02,3.357314e-02,3.027578e-02,2.667866e-02,2.338129e-02,2.008393e-02,1.708633e-02,1.408873e-02,1.169065e-02,9.592326e-03,7.494005e-03,5.995204e-03,4.496403e-03,3.597122e-03,2.697842e-03,2.098321e-03,1.498801e-03,1.199041e-03,8.992806e-04,5.995204e-04,2.997602e-04,2.997602e-04,2.997602e-04),(2.997602e-04,2.997602e-04,2.997602e-04,5.995204e-04,8.992806e-04,1.199041e-03,1.498801e-03,2.098321e-03,2.697842e-03,3.597122e-03,4.496403e-03,5.995204e-03,7.494005e-03,9.592326e-03,1.169065e-02,1.408873e-02,1.708633e-02,2.008393e-02,2.338129e-02,2.667866e-02,3.027578e-02,3.357314e-02,3.687050e-02,3.986811e-02,4.256595e-02,4.496403e-02,4.646283e-02,4.736211e-02,4.796163e-02,4.736211e-02,4.646283e-02,4.496403e-02,4.256595e-02,3.986811e-02,3.687050e-02,3.357314e-02,3.027578e-02,2.667866e-02,2.338129e-02,2.008393e-02,1.708633e-02,1.408873e-02,1.169065e-02,9.592326e-03,7.494005e-03,5.995204e-03,4.496403e-03,3.597122e-03,2.697842e-03,2.098321e-03,1.498801e-03,1.199041e-03,8.992806e-04,5.995204e-04,2.997602e-04,2.997602e-04,2.997602e-04))

# 50 iter delay
# set griptorq.in2 [2,43]((3.996803e-04,3.996803e-04,7.993605e-04,1.199041e-03,1.598721e-03,2.398082e-03,3.597122e-03,5.195843e-03,7.194245e-03,9.992006e-03,1.358913e-02,1.758593e-02,2.278177e-02,2.797762e-02,3.397282e-02,4.036771e-02,4.636291e-02,5.195843e-02,5.675460e-02,6.075140e-02,6.314948e-02,6.394884e-02,6.314948e-02,6.075140e-02,5.675460e-02,5.195843e-02,4.636291e-02,4.036771e-02,3.397282e-02,2.797762e-02,2.278177e-02,1.758593e-02,1.358913e-02,9.992006e-03,7.194245e-03,5.195843e-03,3.597122e-03,2.398082e-03,1.598721e-03,1.199041e-03,7.993605e-04,3.996803e-04,3.996803e-04),(3.996803e-04,3.996803e-04,7.993605e-04,1.199041e-03,1.598721e-03,2.398082e-03,3.597122e-03,5.195843e-03,7.194245e-03,9.992006e-03,1.358913e-02,1.758593e-02,2.278177e-02,2.797762e-02,3.397282e-02,4.036771e-02,4.636291e-02,5.195843e-02,5.675460e-02,6.075140e-02,6.314948e-02,6.394884e-02,6.314948e-02,6.075140e-02,5.675460e-02,5.195843e-02,4.636291e-02,4.036771e-02,3.397282e-02,2.797762e-02,2.278177e-02,1.758593e-02,1.358913e-02,9.992006e-03,7.194245e-03,5.195843e-03,3.597122e-03,2.398082e-03,1.598721e-03,1.199041e-03,7.993605e-04,3.996803e-04,3.996803e-04))

# 10iter delay
set griptorq.in2 [2,17]((1.000000e-03,2.000000e-03,6.000000e-03,1.500000e-02,3.400000e-02,6.300000e-02,1.010000e-01,1.360000e-01,1.580000e-01,1.550000e-01,1.300000e-01,9.300000e-02,5.700000e-02,2.900000e-02,1.300000e-02,5.000000e-03,2.000000e-03),(1.000000e-03,2.000000e-03,6.000000e-03,1.500000e-02,3.400000e-02,6.300000e-02,1.010000e-01,1.360000e-01,1.580000e-01,1.550000e-01,1.300000e-01,9.300000e-02,5.700000e-02,2.900000e-02,1.300000e-02,5.000000e-03,2.000000e-03))

